# テンプレートプレースホルダー定義書

## 概要

見積書テンプレート（Word/Excel）および作業記録テンプレート（Word/Excel）に使用できるプレースホルダーと、各データ項目との対応関係を定義します。

## プレースホルダー形式

### Wordテンプレート（.docx）の場合

`docxtemplater`を使用するため、以下の形式でプレースホルダーを設定します：

```
{{変数名}}
```

**例：**
- `{{companyName}}` → 取引先名
- `{{amount}}` → 金額

### Excelテンプレート（.xlsx）の場合

`exceljs`を使用するため、以下の形式でプレースホルダーを設定します：

```
{{変数名}}
```

**重要：** Excelのセルに直接 `{{変数名}}` と入力してください。
セルの値として設定されていれば、自動的に置換されます。

**例：**
- セル A1 に `{{companyName}}` と入力 → 取引先名に置換
- セル B2 に `{{amount}}` と入力 → 金額に置換

## 利用可能なプレースホルダー一覧

### 取引先情報

| プレースホルダー | 営業案件の項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{companyName}}` | `company.name` | 取引先会社名 | 文字列 | "株式会社○○工業" |
| `{{companyPostalCode}}` | `company.postalCode` | 郵便番号 | 文字列 | "123-4567" |
| `{{companyAddress}}` | `company.address` | 住所 | 文字列 | "東京都○○区..." |
| `{{companyPhone}}` | `company.phone` | 電話番号 | 文字列 | "03-1234-5678" |
| `{{companyEmail}}` | `company.email` | メールアドレス | 文字列 | "info@example.com" |

### 営業案件情報

| プレースホルダー | 営業案件の項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{opportunityTitle}}` | `title` | 案件タイトル | 文字列 | "天井クレーン点検案件" |
| `{{status}}` | `status` | ステータス（英語コード） | 文字列 | "ESTIMATING" |
| `{{statusLabel}}` | `status` | ステータス（日本語） | 文字列 | "見積中" |
| `{{estimatedAmount}}` | `estimatedAmount` | 想定金額（数値のみ、3桁区切りなし） | 数値文字列 | "1000000" |
| `{{estimatedAmountFormatted}}` | `estimatedAmount` | 想定金額（¥記号付き、3桁区切り） | 文字列 | "¥1,000,000" |
| `{{craneCount}}` | `craneCount` | クレーン台数 | 数値文字列 | "5" |
| `{{craneInfo}}` | `craneInfo` | クレーン情報（型式・概要） | 文字列 | "5t天井クレーン..." |
| `{{notes}}` | `notes` | 備考 | 文字列 | "全クレーン設備の包括的点検" |
| `{{occurredAt}}` | `occurredAt` | 発生日（YYYY/MM/DD形式） | 文字列 | "2024/11/17" |
| `{{quoteCount}}` | `_count.quotes` | 見積数 | 数値文字列 | "3" |

### 見積情報

| プレースホルダー | 見積データの項目 | 説明 | データ型 | 例 |
|----------------|---------------|------|---------|-----|
| `{{quoteNumber}}` | `quoteNumber` | 見積番号（Q-YYYYMM-XXXX形式） | 文字列 | "Q-202411-0001" |
| `{{quoteAmount}}` | `amount` | 見積金額（数値のみ、3桁区切りなし、整数） | 数値文字列 | "37000" |
| `{{quoteAmountFormatted}}` | `amount` | 見積金額（¥記号付き、3桁区切り、整数） | 文字列 | "¥37,000" |
| `{{quoteStatus}}` | `status` | 見積ステータス（英語コード） | 文字列 | "DRAFT" |
| `{{quoteStatusLabel}}` | `status` | 見積ステータス（日本語） | 文字列 | "下書き" |
| `{{quoteConditions}}` | `conditions` | 条件 | 文字列 | "納期: 2週間..." |
| `{{quoteValidUntil}}` | `validUntil` | 有効期限（YYYY/MM/DD形式） | 文字列 | "2024/12/31" |
| `{{quoteNotes}}` | `notes` | 備考 | 文字列 | "追加の点検項目について" |
| `{{quoteCreatedAt}}` | `createdAt` | 作成日（YYYY/MM/DD形式） | 文字列 | "2024/11/17" |
| `{{quoteCreatedAtDateTime}}` | `createdAt` | 作成日時（YYYY/MM/DD HH:MM形式） | 文字列 | "2024/11/17 10:30" |
| `{{quoteUpdatedAt}}` | `updatedAt` | 更新日（YYYY/MM/DD形式） | 文字列 | "2024/11/17" |
| `{{quoteUpdatedAtDateTime}}` | `updatedAt` | 更新日時（YYYY/MM/DD HH:MM形式） | 文字列 | "2024/11/17 14:20" |

**注意：** 見積情報は、見積書生成時に選択された見積データから取得されます。

### 見積明細

見積明細は複数行になるため、Excelテンプレートでは以下の方法で表示できます。

#### 方法1: 明細行をループで表示（推奨）

`docxtemplater`や`exceljs`のループ機能を使用する場合、以下の形式でプレースホルダーを設定します：

**Wordテンプレート（.docx）の場合：**
```
{{#items}}
明細番号: {{itemNumber}}
明細内容: {{description}}
数量: {{quantity}}
単価: {{unitPriceFormatted}}
金額: {{amountFormatted}}
備考: {{notes}}
{{/items}}
```

**Excelテンプレート（.xlsx）の場合：**
現在の実装では、ループ機能はサポートされていません。方法2を使用してください。

#### 方法2: 固定行数で明細を表示

Excelテンプレートで固定行数（例: 10行）を用意し、各明細を個別のプレースホルダーで指定します：

**明細1行目：**
| プレースホルダー | 見積明細の項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{item1Number}}` | `items[0].itemNumber` | 明細番号（1行目） | 数値文字列 | "1" |
| `{{item1Description}}` | `items[0].description` | 明細内容（1行目） | 文字列 | "(1) 定期自主検査" |
| `{{item1Quantity}}` | `items[0].quantity` | 数量（1行目、整数） | 数値文字列 | "1" |
| `{{item1UnitPrice}}` | `items[0].unitPrice` | 単価（1行目、整数、3桁区切りなし） | 数値文字列 | "30000" |
| `{{item1UnitPriceFormatted}}` | `items[0].unitPrice` | 単価（1行目、¥記号付き、3桁区切り） | 文字列 | "¥30,000" |
| `{{item1Amount}}` | `items[0].amount` | 金額（1行目、整数、3桁区切りなし） | 数値文字列 | "30000" |
| `{{item1AmountFormatted}}` | `items[0].amount` | 金額（1行目、¥記号付き、3桁区切り） | 文字列 | "¥30,000" |
| `{{item1Notes}}` | `items[0].notes` | 備考（1行目） | 文字列 | "" |

**明細2行目以降：**
同様に、`item2`, `item3`, `item4`, ... `item10` のように番号を変更して使用します。

**例：**
```
明細番号: item2Number, 明細内容: item2Description, 数量: item2Quantity, ...
```

#### 方法3: 明細の合計情報

| プレースホルダー | 説明 | データ型 | 例 |
|----------------|------|---------|-----|
| `{{itemsCount}}` | 明細行数 | 数値文字列 | "3" |
| `{{totalAmount}}` | 合計金額（数値のみ、3桁区切りなし、整数） | 数値文字列 | "37000" |
| `{{totalAmountFormatted}}` | 合計金額（¥記号付き、3桁区切り、整数） | 文字列 | "¥37,000" |

**注意：**
- 見積明細は明細番号（`itemNumber`）の昇順でソートされます
- 数量や単価が`null`の場合は、空文字列または`"-"`が表示されます
- 金額は常に整数（小数点以下なし）で表示されます

### 関連情報（任意）

| プレースホルダー | 営業案件の項目 | 説明 | データ型 | 例 | 備考 |
|----------------|-------------|------|---------|-----|------|
| `{{contractNumber}}` | `contract.contractNumber` | 契約番号 | 文字列 | "C-2024-001" | 契約がある場合のみ |
| `{{contractDate}}` | `contract.contractDate` | 契約日（YYYY/MM/DD形式） | 文字列 | "2024/11/17" | 契約がある場合のみ |
| `{{projectTitle}}` | `project.title` | プロジェクトタイトル | 文字列 | "天井クレーン点検プロジェクト" | プロジェクトがある場合のみ |
| `{{projectStatus}}` | `project.status` | プロジェクトステータス（英語コード） | 文字列 | "IN_PROGRESS" | プロジェクトがある場合のみ |
| `{{projectStatusLabel}}` | `project.status` | プロジェクトステータス（日本語） | 文字列 | "進行中" | プロジェクトがある場合のみ |

## 作業記録テンプレート用プレースホルダー一覧

作業記録テンプレート（テンプレートタイプ: `REPORT`）に使用できるプレースホルダーを以下に示します。

### 作業記録基本情報

| プレースホルダー | 作業記録の項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{workType}}` | `workType` | 作業タイプ（英語コード） | 文字列 | "INSPECTION", "REPAIR", "MAINTENANCE", "OTHER" |
| `{{workTypeLabel}}` | `workType` | 作業タイプ（日本語） | 文字列 | "点検", "修理", "メンテナンス", "その他" |
| `{{inspectionDate}}` | `inspectionDate` | 作業日（YYYY/MM/DD形式） | 文字列 | "2024/11/20" |
| `{{inspectionDateDateTime}}` | `inspectionDate` | 作業日時（YYYY/MM/DD HH:MM形式） | 文字列 | "2024/11/20 14:30" |
| `{{findings}}` | `findings` | 備考 | 文字列 | テキスト |
| `{{documentNumber}}` | `documentNumber` | 整理番号 | 文字列 | テキスト |
| `{{installationFactory}}` | `installationFactory` | 設置工場 | 文字列 | テキスト |

### 機器情報

| プレースホルダー | 機器データの項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{equipmentName}}` | `equipment.name` | 機器名 | 文字列 | "テスト機器" |
| `{{equipmentModel}}` | `equipment.model` | 機種・型式 | 文字列 | "モデル名" |
| `{{equipmentSerialNumber}}` | `equipment.serialNumber` | 製造番号 | 文字列 | "SN123456" |
| `{{equipmentLocation}}` | `equipment.location` | 設置場所 | 文字列 | "1階工場" |
| `{{equipmentSpecifications}}` | `equipment.specifications` | 仕様情報 | 文字列 | テキスト |

### 取引先情報（作業記録用）

| プレースホルダー | 取引先データの項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{companyName}}` | `equipment.company.name` | 取引先会社名 | 文字列 | "株式会社○○工業" |
| `{{companyPostalCode}}` | `equipment.company.postalCode` | 郵便番号 | 文字列 | "123-4567" |
| `{{companyAddress}}` | `equipment.company.address` | 住所 | 文字列 | "東京都○○区..." |
| `{{companyPhone}}` | `equipment.company.phone` | 電話番号 | 文字列 | "03-1234-5678" |
| `{{companyEmail}}` | `equipment.company.email` | メールアドレス | 文字列 | "info@example.com" |

### プロジェクト情報（作業記録用）

| プレースホルダー | プロジェクトデータの項目 | 説明 | データ型 | 例 | 備考 |
|----------------|-------------|------|---------|-----|------|
| `{{projectTitle}}` | `equipment.project.title` | プロジェクトタイトル | 文字列 | "追加点検プロジェクト" | プロジェクトがある場合のみ |
| `{{projectStatus}}` | `equipment.project.status` | プロジェクトステータス（英語コード） | 文字列 | "PLANNING", "IN_PROGRESS", "ON_HOLD", "COMPLETED" | プロジェクトがある場合のみ |
| `{{projectStatusLabel}}` | `equipment.project.status` | プロジェクトステータス（日本語） | 文字列 | "計画中", "進行中", "保留", "完了" | プロジェクトがある場合のみ |
| `{{projectStartDate}}` | `equipment.project.startDate` | プロジェクト開始日（YYYY/MM/DD形式） | 文字列 | "2024/1/1" | プロジェクトがある場合のみ |
| `{{projectEndDate}}` | `equipment.project.endDate` | プロジェクト終了日（YYYY/MM/DD形式） | 文字列 | "2024/12/31" | プロジェクトがある場合のみ |
| `{{projectAmount}}` | `equipment.project.amount` | プロジェクト金額（数値のみ、3桁区切りなし） | 数値文字列 | "1000000" | プロジェクトがある場合のみ |
| `{{projectAmountFormatted}}` | `equipment.project.amount` | プロジェクト金額（¥記号付き、3桁区切り） | 文字列 | "¥1,000,000" | プロジェクトがある場合のみ |

### 担当者情報

| プレースホルダー | 担当者データの項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{userName}}` | `user.name` | 担当者名 | 文字列 | "山田太郎" |
| `{{userEmail}}` | `user.email` | 担当者メールアドレス | 文字列 | "yamada@example.com" |
| `{{userPhone}}` | `user.phone` | 担当者電話番号 | 文字列 | "090-1234-5678" |

### 点検結果データ

| プレースホルダー | 点検結果データの項目 | 説明 | データ型 | 例 |
|----------------|-------------|------|---------|-----|
| `{{checklistData}}` | `checklistData` | 点検結果データ（JSON形式） | 文字列 | `{"hoisting":{"brake":{"lining_wear":"V"}}}` |

**注意：**
- `checklistData`はJSON形式の文字列として提供されます
- 点検タイプ（`workType`が`INSPECTION`）の場合のみ、点検結果データが存在します

### 点検項目の個別プレースホルダー

各点検項目を個別のプレースホルダーとして使用できます。プレースホルダー名は `{{セクションID_カテゴリID_項目ID}}` の形式です。

#### 判定記号

各点検項目には以下の判定記号が設定されます：

| 記号 | ラベル | 説明 |
|------|--------|------|
| V | V（良） | 良好 |
| △ | △（修理要） | 修理が必要 |
| × | ×（特急修理要） | 特急で修理が必要 |
| H | H（手直し済） | 手直し済み |
| P | P（部品取替済） | 部品取替済み |
| A | A（調整済） | 調整済み |
| T | T（増締済） | 増締済み |
| O | O（給油脂済） | 給油脂済み |
| S | S（清掃済） | 清掃済み |
| K | K（経過観察要） | 経過観察が必要 |

#### プレースホルダーの形式

各点検項目には以下のプレースホルダーが用意されています：

1. **判定記号**: `{{セクションID_カテゴリID_項目ID}}`
   - 判定記号（V、△、×、H、P、A、T、O、S、K）が表示されます
   - データがない場合は空文字列になります

2. **処置不良内容（ラベル）**: `{{セクションID_カテゴリID_項目ID_defect_label}}`
   - 処置不良内容のラベル（01. 摩耗、02. 変形など）が表示されます
   - データがない場合は空文字列になります

#### 点検項目一覧

##### 巻上部（hoisting）

**ブレーキ（brake）**
- `{{hoisting_brake_lining_wear}}` - ライニング摩耗の有無（判定記号）
- `{{hoisting_brake_lining_wear_defect_label}}` - ライニング摩耗の有無（処置不良内容ラベル）
- `{{hoisting_brake_slip}}` - スリップ状況（判定記号）
- `{{hoisting_brake_slip_defect_label}}` - スリップ状況（処置不良内容ラベル）
- `{{hoisting_brake_solenoid_shoe_pin}}` - ソレノイド・シュー・ピン 摩耗作動の有無（判定記号）
- `{{hoisting_brake_solenoid_shoe_pin_defect_label}}` - ソレノイド・シュー・ピン 摩耗作動の有無（処置不良内容ラベル）

**リミットスイッチ（limit_switch）**
- `{{hoisting_limit_switch_limit_lever_gap}}` - リミットレバー・ギャップ作動の有無（判定記号）
- `{{hoisting_limit_switch_limit_lever_gap_defect_label}}` - リミットレバー・ギャップ作動の有無（処置不良内容ラベル）
- `{{hoisting_limit_switch_contact_wear_limit}}` - 接点摩耗の有無（判定記号）
- `{{hoisting_limit_switch_contact_wear_limit_defect_label}}` - 接点摩耗の有無（処置不良内容ラベル）

**フレーム（frame）**
- `{{hoisting_frame_crack_deform}}` - 亀裂・変形の有無（判定記号）
- `{{hoisting_frame_crack_deform_defect_label}}` - 亀裂・変形の有無（処置不良内容ラベル）

**ワイヤロープ（チェン）（wire_rope）**
- `{{hoisting_wire_rope_wear}}` - 摩耗の有無（判定記号）
- `{{hoisting_wire_rope_wear_defect_label}}` - 摩耗の有無（処置不良内容ラベル）
- `{{hoisting_wire_rope_wire_break}}` - 素線切断の有無（判定記号）
- `{{hoisting_wire_rope_wire_break_defect_label}}` - 素線切断の有無（処置不良内容ラベル）
- `{{hoisting_wire_rope_rope_end_equalizer}}` - ロープエンド・エコライザー異常の有無（判定記号）
- `{{hoisting_wire_rope_rope_end_equalizer_defect_label}}` - ロープエンド・エコライザー異常の有無（処置不良内容ラベル）

**ロードブロック（load_block）**
- `{{hoisting_load_block_hook_retainer_deform}}` - フック外れ止め金具変形の有無（判定記号）
- `{{hoisting_load_block_hook_retainer_deform_defect_label}}` - フック外れ止め金具変形の有無（処置不良内容ラベル）
- `{{hoisting_load_block_sheave_pin_wear}}` - シーブ・ピン摩耗破損の有無（判定記号）
- `{{hoisting_load_block_sheave_pin_wear_defect_label}}` - シーブ・ピン摩耗破損の有無（処置不良内容ラベル）
- `{{hoisting_load_block_hook_wear}}` - フック摩耗・疵の有無（判定記号）
- `{{hoisting_load_block_hook_wear_defect_label}}` - フック摩耗・疵の有無（処置不良内容ラベル）


##### 横行部（lateral）

**トロリー（trolley）**
- `{{lateral_trolley_wheel_guide_roller_wear}}` - ホイル･ガイドローラー摩耗の有無（判定記号）
- `{{lateral_trolley_wheel_guide_roller_wear_defect_label}}` - ホイル･ガイドローラー摩耗の有無（処置不良内容ラベル）
- `{{lateral_trolley_lateral_motor_reducer}}` - 横行電動・減速機異常の有無（判定記号）
- `{{lateral_trolley_lateral_motor_reducer_defect_label}}` - 横行電動・減速機異常の有無（処置不良内容ラベル）

**ブレーキ（brake_lateral）**
- `{{lateral_brake_lateral_lining_wear_lateral}}` - ライニング摩耗の有無（判定記号）
- `{{lateral_brake_lateral_lining_wear_lateral_defect_label}}` - ライニング摩耗の有無（処置不良内容ラベル）
- `{{lateral_brake_lateral_solenoid_shoe_pin_lateral}}` - ソレノイド・シュー・ピン 摩耗作動の有無（判定記号）
- `{{lateral_brake_lateral_solenoid_shoe_pin_lateral_defect_label}}` - ソレノイド・シュー・ピン 摩耗作動の有無（処置不良内容ラベル）

**横行レール（lateral_rail）**
- `{{lateral_lateral_rail_rail_curvature_lateral}}` - レール曲り及び異常の有無（判定記号）
- `{{lateral_lateral_rail_rail_curvature_lateral_defect_label}}` - レール曲り及び異常の有無（処置不良内容ラベル）
- `{{lateral_lateral_rail_stopper_lateral}}` - ストッパー取付状況（判定記号）
- `{{lateral_lateral_rail_stopper_lateral_defect_label}}` - ストッパー取付状況（処置不良内容ラベル）

##### 走行部（traveling）

**走行レール（traveling_rail）**
- `{{traveling_traveling_rail_obstacle}}` - クレーンガータの走行範囲障害物の有無（判定記号）
- `{{traveling_traveling_rail_obstacle_defect_label}}` - クレーンガータの走行範囲障害物の有無（処置不良内容ラベル）
- `{{traveling_traveling_rail_rail_curvature}}` - レール曲り及び異常の有無（判定記号）
- `{{traveling_traveling_rail_rail_curvature_defect_label}}` - レール曲り及び異常の有無（処置不良内容ラベル）
- `{{traveling_traveling_rail_rail_end_stopper}}` - レール両端のストッパー状況および取付ボルト緩みの有無（判定記号）
- `{{traveling_traveling_rail_rail_end_stopper_defect_label}}` - レール両端のストッパー状況および取付ボルト緩みの有無（処置不良内容ラベル）
- `{{traveling_traveling_rail_rail_bolt}}` - レール取付ボルト緩みの有無（判定記号）
- `{{traveling_traveling_rail_rail_bolt_defect_label}}` - レール取付ボルト緩みの有無（処置不良内容ラベル）

**ガータおよびサドル（girder_saddle）**
- `{{traveling_girder_saddle_girder_saddle_bolt}}` - ガータ・サドル取付ボルト緩みの有無（判定記号）
- `{{traveling_girder_saddle_girder_saddle_bolt_defect_label}}` - ガータ・サドル取付ボルト緩みの有無（処置不良内容ラベル）
- `{{traveling_girder_saddle_guide_roller_wear}}` - ガイドローラー摩耗の有無（判定記号）
- `{{traveling_girder_saddle_guide_roller_wear_defect_label}}` - ガイドローラー摩耗の有無（処置不良内容ラベル）
- `{{traveling_girder_saddle_wheel_gear_oil}}` - ホイールギャ歯面および車軸給油状況の良否（判定記号）
- `{{traveling_girder_saddle_wheel_gear_oil_defect_label}}` - ホイールギャ歯面および車軸給油状況の良否（処置不良内容ラベル）
- `{{traveling_girder_saddle_wheel_axle_wear}}` - 走行車軸の踏面・フランヂ異常摩耗外傷の有無（判定記号）
- `{{traveling_girder_saddle_wheel_axle_wear_defect_label}}` - 走行車軸の踏面・フランヂ異常摩耗外傷の有無（処置不良内容ラベル）
- `{{traveling_girder_saddle_wheel_axle_keep}}` - 車輪軸キープレート変形・緩みの有無（判定記号）
- `{{traveling_girder_saddle_wheel_axle_keep_defect_label}}` - 車輪軸キープレート変形・緩みの有無（処置不良内容ラベル）
- `{{traveling_girder_saddle_saddle_buffer}}` - サドルのバッファ固定状況（判定記号）
- `{{traveling_girder_saddle_saddle_buffer_defect_label}}` - サドルのバッファ固定状況（処置不良内容ラベル）

**走行機械装置（traveling_mechanical）**
- `{{traveling_traveling_mechanical_traveling_motor_reducer}}` - 走行電動減速機異常の有無（判定記号）
- `{{traveling_traveling_mechanical_traveling_motor_reducer_defect_label}}` - 走行電動減速機異常の有無（処置不良内容ラベル）
- `{{traveling_traveling_mechanical_chain_gear_coupling}}` - チェン・ギャー・カップリング軸受摩耗の有無（判定記号）
- `{{traveling_traveling_mechanical_chain_gear_coupling_defect_label}}` - チェン・ギャー・カップリング軸受摩耗の有無（処置不良内容ラベル）
- `{{traveling_traveling_mechanical_lining_wear_mechanical}}` - ライニング摩耗の有無（判定記号）
- `{{traveling_traveling_mechanical_lining_wear_mechanical_defect_label}}` - ライニング摩耗の有無（処置不良内容ラベル）
- `{{traveling_traveling_mechanical_solenoid_shoe_pin_mechanical}}` - ソレノイド・シュー・ピン摩耗作動の有無（判定記号）
- `{{traveling_traveling_mechanical_solenoid_shoe_pin_mechanical_defect_label}}` - ソレノイド・シュー・ピン摩耗作動の有無（処置不良内容ラベル）

##### 走行電気部（traveling_electrical）

**集電装置ほか（collector）**
- `{{traveling_electrical_collector_cushion_starter}}` - クッションスターター作動状況（判定記号）
- `{{traveling_electrical_collector_cushion_starter_defect_label}}` - クッションスターター作動状況（処置不良内容ラベル）
- `{{traveling_electrical_collector_collector_trolley}}` - コレクター・トロリー線摩耗・変形の有無（判定記号）
- `{{traveling_electrical_collector_collector_trolley_defect_label}}` - コレクター・トロリー線摩耗・変形の有無（処置不良内容ラベル）
- `{{traveling_electrical_collector_cabtyre_carrier}}` - キャブタイヤー・キャリアー破損・老化の有無（判定記号）
- `{{traveling_electrical_collector_cabtyre_carrier_defect_label}}` - キャブタイヤー・キャリアー破損・老化の有無（処置不良内容ラベル）
- `{{traveling_electrical_collector_control_panel}}` - 制御盤・電気機器緩みの有無（判定記号）
- `{{traveling_electrical_collector_control_panel_defect_label}}` - 制御盤・電気機器緩みの有無（処置不良内容ラベル）
- `{{traveling_electrical_collector_limit_switch_lever}}` - リミットスイッチ・レバー作動確認（判定記号）
- `{{traveling_electrical_collector_limit_switch_lever_defect_label}}` - リミットスイッチ・レバー作動確認（処置不良内容ラベル）

**給油（lubrication）**
- `{{traveling_electrical_lubrication_hoisting_traveling_oil}}` - 巻上部・走行部給油状況（判定記号）
- `{{traveling_electrical_lubrication_hoisting_traveling_oil_defect_label}}` - 巻上部・走行部給油状況（処置不良内容ラベル）

##### その他（other）

**絶縁抵抗（insulation_resistance）**
- `{{other_insulation_resistance_insulation_resistance_value}}` - 絶縁抵抗（MΩ）（判定記号）
- `{{other_insulation_resistance_insulation_resistance_value_defect_label}}` - 絶縁抵抗（MΩ）（処置不良内容ラベル）

**押釦スイッチ（push_button）**
- `{{other_push_button_contact_wear_button}}` - 接点摩耗の有無（判定記号）
- `{{other_push_button_contact_wear_button_defect_label}}` - 接点摩耗の有無（処置不良内容ラベル）
- `{{other_push_button_wiring_screw}}` - 配線締付ネジゆるみの有無（判定記号）
- `{{other_push_button_wiring_screw_defect_label}}` - 配線締付ネジゆるみの有無（処置不良内容ラベル）
- `{{other_push_button_case_insulation}}` - ケースおよび絶縁板損傷の有無（判定記号）
- `{{other_push_button_case_insulation_defect_label}}` - ケースおよび絶縁板損傷の有無（処置不良内容ラベル）
- `{{other_push_button_cabtyre_aging}}` - キャプタイヤー老化・変形の有無（判定記号）
- `{{other_push_button_cabtyre_aging_defect_label}}` - キャプタイヤー老化・変形の有無（処置不良内容ラベル）

**マグネットスイッチ（magnet_switch）**
- `{{other_magnet_switch_contact_wear_magnet}}` - 接点摩耗の有無（判定記号）
- `{{other_magnet_switch_contact_wear_magnet_defect_label}}` - 接点摩耗の有無（処置不良内容ラベル）
- `{{other_magnet_switch_wiring_screw_magnet}}` - 配線締付ネジゆるみの有無（判定記号）
- `{{other_magnet_switch_wiring_screw_magnet_defect_label}}` - 配線締付ネジゆるみの有無（処置不良内容ラベル）
- `{{other_magnet_switch_operation_check}}` - 作動確認（判定記号）
- `{{other_magnet_switch_operation_check_defect_label}}` - 作動確認（処置不良内容ラベル）

#### 処置不良内容のプレースホルダー

各点検項目には、処置不良内容のプレースホルダーが用意されています。上記の点検項目一覧に記載されている通り、各項目に対して以下のプレースホルダーが利用可能です：

**処置不良内容（ラベル）**: `{{セクションID_カテゴリID_項目ID_defect_label}}`
- 処置不良内容のラベル（01. 摩耗、02. 変形など）が表示されます
- データがない場合は空文字列になります

**処置不良内容の選択肢：**

| コード | ラベル |
|--------|--------|
| 01 | 01. 摩耗 |
| 02 | 02. 変形 |
| 03 | 03. 破損 |
| 04 | 04. 亀裂 |
| 05 | 05. 傷 |
| 06 | 06. 異音 |
| 07 | 07. 焼損 |
| 08 | 08. 断線 |
| 09 | 09. 劣化 |
| 10 | 10. 弛み |
| 11 | 11. 脱落 |
| 12 | 12. 汚損 |
| 13 | 13. 錆 |
| 14 | 14. 素線切れ |
| 15 | 15. キンク |
| 16 | 16. 陥没 |
| 17 | 17. 腐食 |
| 18 | 18. その他 |

**使用例：**

Excelセルに入力する例：
```
ライニング摩耗の有無: {{hoisting_brake_lining_wear}}
処置不良内容: {{hoisting_brake_lining_wear_defect_label}}
スリップ状況: {{hoisting_brake_slip}}
スリップ状況の処置: {{hoisting_brake_slip_defect_label}}
絶縁抵抗: {{other_insulation_resistance_insulation_resistance_value}}
```

**注意：**
- 処置不良内容はラベルのみ（`_defect_label`）が利用可能です
- コード（`_defect`）のプレースホルダーは提供されていません

**注意：**
- 点検タイプ（`workType`が`INSPECTION`）の場合のみ、点検結果データが存在します
- データがない項目は空文字列になります
- 判定記号は記号のみ（V、△、×、H、P、A、T、O、S、K）が表示されます
- 処置不良内容は判定記号と独立して入力できます（判定記号がなくても処置不良内容を入力可能）
- 絶縁抵抗（`insulation_resistance_value`）は数値が直接入力される場合があるため、数値そのものが表示されます

## テンプレートファイルの命名規則

### 推奨命名規則

テンプレートファイルのファイル名は、以下の規則に従うことを推奨します：

#### 基本形式

```
[テンプレートタイプ]_[説明]_[バージョン].[拡張子]
```

#### 命名例

**見積書テンプレート：**
- `見積書テンプレート_標準版.xlsx`
- `見積書テンプレート_2024.xlsx`
- `見積書_簡易版_v1.xlsx`
- `quote_template_standard.xlsx`

**契約書テンプレート：**
- `契約書テンプレート_標準版.xlsx`
- `契約書_詳細版.xlsx`
- `contract_template_v1.xlsx`

**報告書テンプレート（作業記録用）：**
- `作業記録テンプレート_標準版.xlsx`
- `作業記録_簡易版.xlsx`
- `作業報告書テンプレート_2024.xlsx`
- `work_record_template_standard.xlsx`

#### 命名規則のポイント

1. **テンプレートタイプを明示**
   - 見積書、契約書、報告書など、用途が分かるようにする

2. **説明を追加（任意）**
   - 標準版、簡易版、詳細版など、バリエーションを区別

3. **バージョン番号（任意）**
   - `v1`, `v2`, `2024`, `2024-11` など、バージョン管理が可能

4. **拡張子を保持**
   - `.xlsx`（Excel）または `.docx`（Word）

#### 注意事項

- **システム内での管理：** ファイル名はデータベースの`name`フィールドで管理されるため、ファイル名自体は識別用として使用されます
- **重複：** 同じファイル名でも、システム内では異なるIDで管理されるため問題ありません
- **日本語可：** 日本語のファイル名も使用可能です
- **特殊文字：** `/`, `\`, `:`, `*`, `?`, `"`, `<`, `>`, `|` などの特殊文字は避けてください

## Excelテンプレートの作成方法

### 1. Excelファイルを開く

Microsoft Excel または LibreOffice Calc で新しいファイルを作成します。

**推奨：** ファイル名は上記の命名規則に従って保存してください。

### 2. プレースホルダーを配置

見積書のフォーマットに従って、各セルにプレースホルダーを入力します。

**例：**
```
| A列          | B列                  |
|--------------|----------------------|
| 取引先名：    | {{companyName}}      |
| 郵便番号：    | {{companyPostalCode}}|
| 住所：        | {{companyAddress}}   |
| 電話番号：    | {{companyPhone}}     |
| メール：      | {{companyEmail}}     |
|              |                      |
| 案件タイトル：| {{opportunityTitle}} |
| 想定金額：    | {{estimatedAmountFormatted}} |
| クレーン台数：| {{craneCount}}台     |
| クレーン情報：| {{craneInfo}}        |
| 備考：        | {{notes}}            |
| 発生日：      | {{occurredAt}}       |
| 見積数：      | {{quoteCount}}件     |
```

### 3. セルの書式設定（任意）

必要に応じて、セルの書式設定を行います：
- 金額のセル：通貨形式（例: `¥#,##0`）
- 日付のセル：日付形式（例: `yyyy/mm/dd`）

**注意：** プレースホルダーを置換した後、書式設定は維持されます。

### 4. ファイルを保存

`.xlsx`形式で保存します。

### 5. システムにアップロード

作成したExcelテンプレートをシステムにアップロードします：

**アップロード方法：**
- 詳細は `docs/テンプレートアップロード手順.md` を参照してください
- APIエンドポイント: `/api/document-templates` (POST)
- ブラウザの開発者ツール（コンソール）からもアップロード可能
- または、後で実装するテンプレート管理画面からアップロード

## Wordテンプレートの作成方法

### 1. Wordファイルを開く

Microsoft Word で新しいファイルを作成します。

### 2. プレースホルダーを配置

見積書のフォーマットに従って、本文中にプレースホルダーを入力します。

**例：**
```
見積書

取引先名：{{companyName}}
郵便番号：{{companyPostalCode}}
住所：{{companyAddress}}
電話番号：{{companyPhone}}
メール：{{companyEmail}}

案件タイトル：{{opportunityTitle}}
ステータス：{{statusLabel}}
想定金額：{{estimatedAmountFormatted}}
クレーン台数：{{craneCount}}台
クレーン情報：{{craneInfo}}
備考：{{notes}}
発生日：{{occurredAt}}
見積数：{{quoteCount}}件

【見積情報】
見積番号：{{quoteNumber}}
見積金額：{{quoteAmountFormatted}}
ステータス：{{quoteStatusLabel}}
条件：{{quoteConditions}}
有効期限：{{quoteValidUntil}}
備考：{{quoteNotes}}
作成日：{{quoteCreatedAt}}

【見積明細】
{{#items}}
明細番号: {{itemNumber}}
明細内容: {{description}}
数量: {{quantity}}
単価: {{unitPriceFormatted}}
金額: {{amountFormatted}}
備考: {{notes}}

{{/items}}

合計金額：{{totalAmountFormatted}}
```

### 3. ファイルを保存

`.docx`形式で保存します。

### 4. システムにアップロード

作成したWordテンプレートをシステムにアップロードします。

**アップロード方法：**
- 詳細は `docs/テンプレートアップロード手順.md` を参照してください
- APIエンドポイント: `/api/document-templates` (POST)
- ブラウザの開発者ツール（コンソール）からもアップロード可能

## データの変換ルール

### 金額

- `estimatedAmount`: 数値のみ（例: `1000000`）
- `estimatedAmountFormatted`: ¥記号と3桁区切り（例: `¥1,000,000`）
- `quoteAmount`: 数値のみ、整数（例: `37000`）
- `quoteAmountFormatted`: ¥記号と3桁区切り、整数（例: `¥37,000`）
- `item1Amount`, `item2Amount`, ...: 数値のみ、整数（例: `30000`）
- `item1AmountFormatted`, `item2AmountFormatted`, ...: ¥記号と3桁区切り、整数（例: `¥30,000`）
- `totalAmount`: 数値のみ、整数（例: `37000`）
- `totalAmountFormatted`: ¥記号と3桁区切り、整数（例: `¥37,000`）

### 日付

- `occurredAt`: YYYY/MM/DD形式（例: `2024/11/17`）
- `quoteCreatedAt`: YYYY/MM/DD形式（例: `2024/11/17`）
- `quoteCreatedAtDateTime`: YYYY/MM/DD HH:MM形式（例: `2024/11/17 10:30`）
- `quoteUpdatedAt`: YYYY/MM/DD形式（例: `2024/11/17`）
- `quoteUpdatedAtDateTime`: YYYY/MM/DD HH:MM形式（例: `2024/11/17 14:20`）
- `quoteValidUntil`: YYYY/MM/DD形式（例: `2024/12/31`）

### 見積ステータス

- `quoteStatus`: 英語コード（例: `"DRAFT"`, `"SENT"`, `"ACCEPTED"`, `"REJECTED"`）
- `quoteStatusLabel`: 日本語（例: `"下書き"`, `"送信済み"`, `"承認済み"`, `"却下"`）

### NULL値の処理

- データがNULLの場合は、空文字列（`""`）に変換されます
- 数値がNULLの場合は、空文字列または`"-"`が表示されます
- 数量や単価がNULLの場合は、空文字列または`"-"`が表示されます

### 見積明細の処理

- 見積明細は明細番号（`itemNumber`）の昇順でソートされます
- 固定行数方式（方法2）を使用する場合、明細が存在しない行は空文字列が表示されます
- 明細が指定された行数（例: 10行）を超える場合、超えた分は表示されません（制限事項）

### 作業記録の処理

- 作業タイプ（`workType`）は英語コードと日本語ラベルの両方が利用可能です
- 総合判定（`overallJudgment`）は点検タイプ（`INSPECTION`）の場合のみ存在します
- プロジェクト情報は、機器がプロジェクトに紐付けられている場合のみ表示されます
- 点検結果データ（`checklistData`）はJSON形式の文字列として提供されます

## トラブルシューティング

### プレースホルダーが置換されない

1. プレースホルダーの形式を確認（`{{変数名}}`）
2. 変数名のスペルミスを確認
3. セルの値として設定されているか確認（Excelの場合）
4. テンプレートが正しくアップロードされているか確認

### 日付や金額のフォーマットが期待通りでない

1. Excel/Wordのセル書式設定を確認
2. プレースホルダーを置換した後、書式設定を再適用

### エラーが発生する

1. テンプレートファイルが破損していないか確認
2. ファイル形式が正しいか確認（.docx または .xlsx）
3. APIエンドポイントのログを確認
