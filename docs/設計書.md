# 点検管理システム 仕様設計書（草案）

## 1. 概要

- **目的**：天井クレーンの点検業務を、点検業者が案件登録から報告書共有・精算まで一元管理できるWebシステムとして構築する。
- **主な利用デバイス**：PCを主利用とし、タブレット・スマートフォンからもレスポンシブWebアプリでアクセス可能。オフライン環境では手書き記録＋OCR連携も検討。

## 2. 利用前提

- 本システムは点検業者の業務管理が目的であり、工場ユーザーとのやり取りや支払い処理はシステム外で実施される。（集客から受注・契約連絡等は天井クレーン見積り.comにて実施）

## 3. 業務フロー

1. **依頼・ヒアリング**
   - 工場ユーザーから点検依頼を受領。
   - 点検業者が対象クレーンの台数、メーカー／型番、利用状況や劣化状況などをヒアリング。
   - ヒアリング結果をもとに案件登録を開始し、その際、取引先が新規の場合はシステム上で新規登録が可能。

2. **案件登録（営業管理）**
   - `取引先マスタ` から顧客を検索・選択（未登録なら新規登録）。
   - 営業案件として対象クレーン情報（台数・型式・概要）や想定金額を入力し登録。
   - 「見積作成」ボタンで登録情報を見積書フォーマットに自動差し込み → 工場ユーザーへ提示。

3. **受注・契約**
   - 工場ユーザーが見積内容を承認すると案件ステータスを「受注」へ更新。
   - 「契約書作成」ボタンで契約書を生成（見積の金額・条件を反映）。

4. **プロジェクト化**
   - 受注登録と同時にプロジェクトデータを自動生成。
   - 営業案件の内容（顧客、クレーン、金額、スケジュール候補など）をプロジェクトに複製。

5. **スケジュール調整**
   - 工場ユーザーと点検日等、スケジュールを調整し、プロジェクト内のスケジュール情報に登録。
   - プロジェクトへ対象機器（機器マスタ参照）を紐付け。

6. **点検実施・結果入力**
   - 点検当日、ネット接続があればシステム上で点検結果を直接入力。
   - オフラインの場合は専用用紙に手書き記録 → 後日スキャンし、OCR 連携で結果をシステムへ取り込みを検討。
   - 点検結果は対象クレーン（機器マスタ）へ履歴としてリンク。

7. **報告書作成・共有**
   - プロジェクト詳細画面の「報告書作成」ボタンで、最新の点検データを報告書フォーマットに自動差し込み。
   - 生成された報告書（PDF 等）を工場ユーザーへ共有。

8. **精算状況記録・完了**
   - 工場ユーザー側で支払いが行われたかを点検業者が確認（確認作業はシステム外）。
   - 入金確認情報のみをシステムに記録し、プロジェクトステータスを「完了」に更新して案件をクローズ。

## 4. 機能一覧

### 4.1 取引先管理

- 取引先マスタの新規登録（会社名、担当者、連絡先、属性など）。
- 登録済み取引先の検索・詳細閲覧。
- 関連営業案件の確認。
- 保有している機器の一覧を閲覧できる。
- 一覧画面から新規機器登録も可能（自社保有分の機器マスタ追加）。


### 4.2 営業案件管理

- 案件作成／編集／ステータス管理（見積中／受注／失注など）。
- 取引先の選択・紐付け、また新規作成ボタンにより取引先管理の作成画面へ遷移。
- 1つの営業案件に対して、複数の見積もりデータを作成・管理可能。
  - 各見積もりごとに金額や条件、バージョン履歴などを保持。
  - 作成済み見積もりの参照・複製・編集および最新版の見積もりを選択して提示可能。
- 見積書自動生成（登録金額・内容の差し込み）。

### 4.3 契約管理

- 受注時の契約書自動生成。
   - 複数の見積書が存在する場合、どの見積書の内容を契約書作成に引用するか選択可能。
   - 選択した見積書の金額・条件等を契約書へ自動反映。
   - 契約書 PDF の管理・バージョン履歴。

### 4.4 プロジェクト管理

- 受注案件から自動生成されたプロジェクトの管理。
- プロジェクト概要（顧客、対象機器、金額、担当メンバー）、スケジュール、添付管理。
- 進捗ステータス（計画中／進行中／保留／完了など）の更新。
- プロジェクト管理画面で「報告書作成」を実行すると、対象取引先と対象クレーンの最新点検結果を差し込んだ報告書を一括生成。
  - 生成した報告書はプロジェクト内で履歴管理し、再出力や共有リンクの更新に対応。

### 4.5 機器台帳管理

- 機器マスタとして名称、型式、製造番号、設置場所、仕様などを登録。
- プロジェクト毎に対象機器を紐付け。

### 4.6 点検記録管理

- 各機器ごとに点検結果（履歴）を一覧・参照できる。
- 点検結果入力フォーム（点検日、担当者、チェックリスト、所見、写真添付）。
- 固定チェックリストに加え、案件ごとに必要な追加項目を追加入力できる。
- オフライン対応：手書き用紙 → OCR 取り込みで後日システム反映。
- 点検履歴のタイムライン表示。

### 4.7 精算状況記録・完了処理

- 支払い状況をメモ・記録（システム外での支払いを前提）。
- 完了ステータスへの更新と履歴保全。

## 5. データモデル（主要テーブル）

| テーブル | 主な内容 | 補足 |
| --- | --- | --- |
| `companies` | 取引先 | 会社名、所在地、業種区分、請求関連フラグ等 |
| `company_contacts` | 取引先担当者 | 氏名、役職、連絡先、対応履歴メモ |
| `equipment` | 機器 | クレーンの機種、製造番号、設置場所、仕様情報、現在紐付くプロジェクトID |
| `inspection_records` | 点検情報 | 対象機器、点検日、担当者、総合判定、所見、結果サマリ、追加項目メモ |
| `sales_opportunities` | 営業案件 | 案件ステータス（見積中／受注／失注）、想定金額、発生日等 |
| `sales_quotes` | 見積情報 | 対象営業案件ID、金額・条件、見積番号（`Q-YYYYMM-XXXX` 採番想定）、ステータス、作成日、有効期限、備考 |
| `contracts` | 受注書 | 受注日、契約番号、採用見積参照、契約条件、帳票リンク |
| `projects` | プロジェクト | 受注後の実行管理。対象取引先、担当メンバー、進捗、期間等 |
| `users` | ユーザー | ログインID、ハッシュ化パスワード、権限ロール（管理者／編集者／閲覧者）、連絡先 |

※帳票テンプレートや OCR ログなどは今後の設計対象。

## 6. 非機能・追加検討事項

- オフライン時のデータ保持と後送設計（PWA や同期タイミングの定義）。
- OCR 連携：フォーマットの標準化、認識精度、補正ワークフロー。
- 権限管理：ロール別アクセス制御、監査ログの保存。
- 通知機能：メール／リマインド（点検日、支払い確認など）。
- 帳票テンプレートのバージョン管理。
- セキュリティ（認証、通信暗号化）、バックアップポリシー。
- スクリプト制御ウィンドウでの操作性確保（モーダルの多重表示、ショートカット、パフォーマンス対策）。
- プロジェクト詳細画面でのタブ構成（概要／スケジュール／タスク／クレーン台帳／点検記録）と報告書作成ボタン配置。
- 点検記録画面のクレーン別タイムライン表示、点検履歴参照、報告書プレビューへの遷移導線。
- 報告書プレビュー画面での差し込み項目編集、PDF プレビュー、出力・共有操作の UX 設計。
- ユーザー権限ロール（管理者／編集者／閲覧者）ごとの操作範囲と表示制御。
- 帳票は必要時に再生成してダウンロード提供する運用（PDF はサーバー保存せずオンデマンド出力）。

---

本書は現時点の整理内容をまとめた草案であり、今後の要件精査に応じて更新予定。追加・修正事項があれば適宜反映する。


