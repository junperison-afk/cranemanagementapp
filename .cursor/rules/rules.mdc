---
alwaysApply: true
---

# 開発ルール

- クレーン管理アプリの実装時は、`docs/設計書.md` および `docs/UI設計.md` を常に参照し、これらの内容に沿ってコーディング方針を決定すること。
- 設計書を改定する場合は、内容の整合性を確認し、関係者レビュー後に実装へ着手すること。
- Git コミット／プッシュはユーザーの指示がある場合に限り、コミットメッセージは日本語で概要と影響範囲を明記すること。
- コード内の命名・コメントは原則日本語を使用し、外部公開が前提の箇所のみ英語を用いること。
- 設計書に記載のない仕様・UIを決定する場合は、Zoho CRM の設計・作りを参考に補完し、その判断を明文化すること。

## コンポーネント設計と共通化

### 共通化の原則
- **DRY原則（Don't Repeat Yourself）**: 同じコードが3回以上出現する場合は、共通コンポーネントまたはユーティリティ関数として抽出すること。
- **コンポーネントの再利用性**: 複数の画面で使用される機能（ページネーション、フィルター、テーブルヘッダーなど）は、共通コンポーネントとして `components/common/` ディレクトリに配置すること。
- **単一責任の原則**: 各コンポーネントは1つの責任のみを持つように設計すること。
- **関心の分離**: UIロジック、ビジネスロジック、データ取得ロジックは適切に分離すること。

### 共通化の判断基準
以下のような機能は共通コンポーネント化を検討すること：
- ページネーション（データ件数表示、ページサイズ選択、前後ページナビゲーション）
- フィルター機能（フィルターボタン、フィルターパネル、フィルター適用ロジック）
- テーブル表示（ヘッダー、行、セル、ソート機能）
- フォーム要素（入力フィールド、セレクトボックス、日付ピッカーなど）
- モーダル・ダイアログ
- ローディング表示
- エラー表示
- バリデーションメッセージ

### 共通コンポーネントの配置
```
components/
├── common/              # 共通コンポーネント
│   ├── pagination-header.tsx
│   ├── filter-panel.tsx
│   ├── data-table.tsx
│   └── ...
├── [feature]/          # 機能別コンポーネント
│   ├── [feature]-table.tsx
│   └── ...
└── layout/             # レイアウトコンポーネント
    └── ...
```

## Next.js/Reactの設計思想に従ったコーディング

### Next.js App Routerの原則
- **Server Componentsを優先**: デフォルトでServer Componentsを使用し、必要な場合のみClient Components（`"use client"`）を使用すること。
- **ファイルベースルーティング**: `app/` ディレクトリ内のファイル構造でルーティングを管理すること。
- **データ取得の分離**: Server Componentsでデータ取得を行い、Client Componentsにはpropsとして渡すこと。
- **API Routes**: サーバーサイドのロジックは `app/api/` ディレクトリに配置すること。

### Reactの設計原則
- **コンポーネントの分割**: 大きなコンポーネントは、小さな再利用可能なコンポーネントに分割すること。
- **Propsの型定義**: TypeScriptの型定義を必ず使用し、`interface` または `type` でPropsの型を明示すること。
- **カスタムフック**: 再利用可能なロジックはカスタムフック（`hooks/` ディレクトリ）として抽出すること。
- **状態管理**: 
  - ローカル状態は `useState` を使用
  - グローバル状態は React Context API または TanStack Query を使用
  - 複雑な状態管理が必要な場合は Zustand を検討
- **副作用の管理**: `useEffect` の依存配列を適切に設定し、不要な再レンダリングを避けること。

### TypeScriptの活用
- **厳密な型定義**: `any` 型の使用を避け、適切な型定義を行うこと。
- **型の再利用**: 共通の型定義は `types/` ディレクトリに配置すること。
- **型安全性**: Prismaの型定義を活用し、データベーススキーマと型を同期させること。

## 技術スタックの設計思想

### Tailwind CSS
- **ユーティリティファースト**: インラインスタイルではなく、Tailwindのユーティリティクラスを使用すること。
- **カスタムクラス**: 繰り返し使用されるスタイルパターンは `@apply` ディレクティブでカスタムクラスとして定義すること。
- **レスポンシブデザイン**: `sm:`, `md:`, `lg:` などのブレークポイントを適切に使用すること。

### Prisma
- **型安全なクエリ**: Prisma Clientの型定義を活用し、コンパイル時にエラーを検出すること。
- **リレーションの活用**: データベースのリレーションを適切に定義し、`include` や `select` を効率的に使用すること。
- **トランザクション**: 複数のデータベース操作が必要な場合は、Prismaのトランザクション機能を使用すること。

### NextAuth.js
- **セッション管理**: サーバーサイドでセッションを管理し、適切に保護すること。
- **認証状態の取得**: `getSession()` を使用してサーバーサイドで認証状態を確認すること。

### TanStack Query (React Query)
- **サーバー状態の管理**: サーバーから取得するデータはTanStack Queryで管理すること。
- **キャッシュ戦略**: 適切なキャッシュ時間と再検証戦略を設定すること。

## コード品質

### 命名規則
- **コンポーネント**: PascalCase（例: `PaginationHeader`, `CompanyTable`）
- **ファイル名**: kebab-case（例: `pagination-header.tsx`, `company-table.tsx`）
- **変数・関数**: camelCase（例: `totalCount`, `handleSubmit`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_ITEMS_PER_PAGE`）
- **型・インターフェース**: PascalCase（例: `UserData`, `TableProps`）

### コメント
- **日本語コメント**: コード内のコメントは日本語で記述すること。
- **JSDoc**: 関数やコンポーネントにはJSDoc形式で説明を追加すること。
- **複雑なロジック**: 複雑なビジネスロジックには、なぜその実装にしたかの理由をコメントで説明すること。

### エラーハンドリング
- **適切なエラー処理**: try-catch文を適切に使用し、エラーを適切に処理すること。
- **ユーザーフレンドリーなエラーメッセージ**: エラーメッセージは日本語で、ユーザーが理解しやすい表現にすること。

### パフォーマンス
- **不要な再レンダリングの回避**: `React.memo`, `useMemo`, `useCallback` を適切に使用すること。
- **コード分割**: 大きなコンポーネントは動的インポート（`next/dynamic`）を使用してコード分割すること。
- **画像最適化**: Next.jsの `Image` コンポーネントを使用して画像を最適化すること。

## 開発フロー

### 新機能の実装
1. 設計書・UI設計書を確認
2. 既存の共通コンポーネントを確認し、再利用可能なものがないか検討
3. 必要に応じて共通コンポーネントを作成
4. 機能を実装
5. コードレビュー（可能な場合）
6. テスト（可能な場合）

### リファクタリング
- **定期的な見直し**: コードの重複を定期的に確認し、共通化できる部分を抽出すること。
- **段階的な改善**: 一度にすべてを変更せず、段階的にリファクタリングを進めること。

